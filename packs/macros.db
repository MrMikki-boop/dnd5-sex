{"name":"Проверка Соблазнения","type":"script","scope":"global","author":"2zWP9xXRmUV8CSae","img":"icons/magic/life/heart-glowing-red.webp","command":"if (!actor) {\n  ui.notifications.error(\"Пожалуйста, выберите актера.\");\n  return;\n}\n\nnew Dialog({\n  title:'Проверка Соблазнения',\n  content:`\n    <form>\n      <div class=\"form-group\">\n        <label>Способ соблазнения</label>\n        <select name=\"seductionApproach\">\n           <option value=\"dec\">Обман</option>\n           <option value=\"prf\">Исполнение/Выступление</option>\n           <option value=\"per\">Убеждение</option>\n        </select>\n      </div>\n    </form>`,\n  buttons:{\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: `Совершить проверку`\n    }},\n  default:'yes',\n  close: html => {\n    const selectEl = html.find('select[name=\\\"seductionApproach\\\"]')[0];\n    const seductionSkillId = selectEl.value;\n    const skillNamesMap = { per: 'Убеждения', dec: 'Обмана', prf: 'Исполнения' }\n\n    actor.rollSkill(seductionSkillId).then(res => {\n      if (!res || !res.total) return;\n\n      let chatData = {\n          user: game.user._id,\n          speaker: ChatMessage.getSpeaker({ actor }),\n\t  content: `Cовершает проверку Соблазнения с помощью навыка ${skillNamesMap[seductionSkillId]}. Результат: <strong>${res.total}</strong>`\n      };\n      ChatMessage.create(chatData, {});\n    })\n  }\n}).render(true);","flags":{"core":{"sourceId":"Macro.nciOf3Q0lnMNQUXp"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1683568287704,"modifiedTime":1683665285670,"lastModifiedBy":"2zWP9xXRmUV8CSae"},"folder":null,"sort":0,"ownership":{"default":0,"2zWP9xXRmUV8CSae":3},"_id":"8PcaZkrSscChbkl0"}
{"name":"Расчет сложности Беременности","type":"script","scope":"global","author":"2zWP9xXRmUV8CSae","img":"icons/magic/life/heart-red-blue.webp","command":"const tokens = game.canvas.tokens?.controlled;\n\nif (!tokens?.length || tokens.length > 1) {\n    ui.notifications.error(\"Пожалуйста, выберите 1 токен.\");\n    return;\n}\n\nconst selectedActor = tokens[0].actor;\nconst complexity = 15 - selectedActor.system.abilities.con.mod;\nconst buttonId = `omar0275-${Date.now()}`\n\nChatMessage.create({ \n    speaker: ChatMessage.getSpeaker({ actor: selectedActor }),\n    content: `Сложность проверки Беременности равна ${complexity}. <button class=\"${buttonId}\" style=\"height: 24px; font-size: 12px; line-height: 20px; margin: 2px 0; background: rgba(0, 0, 0, 0.1); border: 2px groove #eeede0\">Проверка Беременности ${complexity}</button>`,\n}).then(msg => {\n    const btn = document.body.querySelector(`button.${buttonId}`);\n    btn.addEventListener('click', () => {\n        const selectedTokens = game.canvas.tokens.controlled;\n        \n        if (!selectedTokens?.length || selectedTokens.length > 1) {\n            ui.notifications.error(\"Выберите 1 токен.\");\n            return;\n        }\n\n        game.macros.getName('Проверка Беременности').execute();\n    });\n});","flags":{"core":{"sourceId":"Macro.qc70v4oNriX9fjQT"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1683680645781,"modifiedTime":1683683048200,"lastModifiedBy":"2zWP9xXRmUV8CSae"},"folder":null,"sort":0,"ownership":{"default":0,"2zWP9xXRmUV8CSae":3},"_id":"LG88S9FYpDp888K8"}
{"name":"Проверка Беременности","type":"script","scope":"global","author":"2zWP9xXRmUV8CSae","img":"icons/magic/life/heart-pink.webp","command":"if (!actor) {\n  ui.notifications.error(\"Пожалуйста, выберите токен.\");\n  return;\n}\n\nactor.rollAbilityTest('con', { flavor: 'Проверка Беременности' });","flags":{"core":{"sourceId":"Macro.5onYS5Emubx06Qj5"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1683680816387,"modifiedTime":1683682939519,"lastModifiedBy":"2zWP9xXRmUV8CSae"},"folder":null,"sort":0,"ownership":{"default":0,"2zWP9xXRmUV8CSae":3},"_id":"UAY2jwQDFRkLpE4L"}
{"name":"Расчет сложности Соблазнения","type":"script","scope":"global","author":"2zWP9xXRmUV8CSae","img":"icons/magic/life/heart-hand-gold-green-light.webp","command":"const isGM = game.user.isGM;\n\nif (!isGM) {\n  ui.notifications.info(\"Только GM может использовать этот макрос\");\n  return;\n}\n\nif (!actor) {\n  ui.notifications.error(\"Пожалуйста, выберите актера.\");\n  return;\n}\n\nnew Dialog({\n  title:'Настройка испытания Соблазнения',\n  content:`\n    <p>Базовая Сл Соблазнения = 15 + модификатор Силы или Ловкости (по выбору Мастера) + модификатор Харизмы</p>\n    <form>\n      <div class=\"form-group\">\n        <label>Характеристика по выбору</label>\n        <select name=\"ability\">\n           <option value=\"str\">Сила</option>\n           <option value=\"dex\">Ловкость</option>\n        </select>\n      </div>\n      <div class=\"form-group\">\n          <label>Модификатор (например от ориентации)</label>\n          <input type=\"number\" name=\"modifier\" value=\"0\" />\n      </div>\n    </form>`,\n  buttons:{\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: `Ок`\n    }\n  },\n  default:'yes',\n  close: html => {\n     const abilityId = html.find('select[name=\"ability\"]')[0].value;\n     const modifier = html.find('input[name=\"modifier\"]')[0].value;\n\n     const complexity = 15 + +modifier + actor.system.abilities[abilityId].mod + actor.system.abilities.cha.mod;\n     const buttonId = 'omar0275-' + Date.now();\n\n     ChatMessage.create({ \n        speaker: ChatMessage.getSpeaker({ actor }),\n        content: `Базовая сложность соблазнения - ${complexity}. <button class=\"${buttonId}\" style=\"height: 24px; font-size: 12px; line-height: 20px; margin: 2px 0; background: rgba(0, 0, 0, 0.1); border: 2px groove #eeede0\">Проверка Соблазнения ${complexity}</button>`,\n     }).then(msg => {\n        const btn = document.body.querySelector(`button.${buttonId}`);\n        btn.addEventListener('click', () => {\n            const selectedTokens = game.canvas.tokens.controlled;\n            if (!selectedTokens?.length || selectedTokens.length > 1) {\n                ui.notifications.error(\"Выберите 1 токен.\");\n                return;\n            }\n\n            game.macros.getName('Проверка Соблазнения').execute();\n        })\n     });\n  }\n}).render(true);","flags":{"core":{"sourceId":"Macro.wEvVWyshTbkTnj44"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1683584956363,"modifiedTime":1683652146271,"lastModifiedBy":"2zWP9xXRmUV8CSae"},"folder":null,"sort":0,"ownership":{"default":0,"2zWP9xXRmUV8CSae":3},"_id":"ZvgLmyzVTaB3bMiK"}
